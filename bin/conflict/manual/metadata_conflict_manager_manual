#!/bin/bash
#Ask user what to do if a conflict is declared with metadatas

#Testing arguments
if [ $# -ne 2 ]
then
        echo "Usage $0 : pathA pathB"
        exit 1
fi

if [[ ! -f $1 ]]
then
        echo "$1 not found !"
        exit 2
elif [[ ! -f $2 ]]
then
        echo "$2 not found !"
        exit 2
fi

#Display error
echo "Metadatas conflict detected ! Details of the compromised files are described below :"

#Get permissions (readable by human)
permFileA=$(stat -c %A $1)
permFileB=$(stat -c %A $2)

#Get last modification date (readable by Human)
dateFileA=$(stat -c %y $1 | cut -d "." -f 1)
dateFileB=$(stat -c %y $2 | cut -d "." -f 1)

#Get size
sizeFileA=$(du -b $1 | cut -f 1)
sizeFileB=$(du -b $2 | cut -f 1)

#Asking user
echo -e "File $1 : \nPermission : $permFileA\nLast Modification : $dateFileA\nSize : $sizeFileA bytes"
echo -e "File $2 : \nPermission : $permFileB\nLast Modification : $dateFileB\nSize : $sizeFileB bytes"
echo -e "Which metadata do we have to save ?\nMetadatas of $1 [1]\nMetadatas of $2 [2]"
echo -e "Your choice [1/2] : "

read userChoice

until [ $userChoice = "1" -o $userChoice = "2" ]
do
	echo "Incorrect answer ! Please use 1 or 2 to select the relevant option"
	echo -e "Which metadata do we have to save ?\nMetadatas of $1 [1]\nMetadatas of $2 [2]"
	echo "Your choice [1/2] : "
	read userChoice
done


#Executing selected option
if [ $userChoice = "1" ]
then
	#Using copy-paste of file to conserve the metadatas
	bin/element_duplicator $1 $2
else
	bin/element_duplicator $1 $2
fi
